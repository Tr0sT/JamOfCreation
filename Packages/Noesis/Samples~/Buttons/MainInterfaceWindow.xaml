<UserControl xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:na="clr-namespace:NoesisApp;assembly=Noesis"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:local="clr-namespace:NuclearBand.Game">

  <UserControl.Resources>

    <!-- Общие стили -->
    <Style x:Key="BarContainer" TargetType="Border">
      <Setter Property="CornerRadius" Value="8"/>
      <Setter Property="Padding" Value="6"/>
      <Setter Property="Background" Value="#202226"/>
    </Style>

    <Style x:Key="StatLabel" TargetType="TextBlock">
      <Setter Property="FontSize" Value="20"/>
      <Setter Property="Foreground" Value="#E6E6E6"/>
      <Setter Property="Margin" Value="0,0,0,6"/>
    </Style>

    <!-- DataTemplate для прогресс-бара -->
    <DataTemplate x:Key="ResourceBarTemplate">
      <Grid>
        <Grid.RowDefinitions>
          <RowDefinition Height="Auto"/>
          <RowDefinition Height="28"/>
        </Grid.RowDefinitions>

        <TextBlock Text="{Binding Name}" Style="{StaticResource StatLabel}"/>
        <Border Grid.Row="1" Style="{StaticResource BarContainer}">
          <Grid>
            <Rectangle Fill="#2C2F33" RadiusX="6" RadiusY="6"/>
            <Rectangle Fill="{Binding ForegroundBrush, FallbackValue=#6FA8DC}"
                       HorizontalAlignment="Stretch"
                       RenderTransformOrigin="0,0.5">
              <Rectangle.RenderTransform>
                <ScaleTransform ScaleX="{Binding Progress}" />
              </Rectangle.RenderTransform>
            </Rectangle>
            <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center"
                       Foreground="#F3F3F3"
                       Text="{Binding Value}"/>
          </Grid>
        </Border>
      </Grid>
    </DataTemplate>

    <!-- DataTemplate для элемента списка действий -->
    <DataTemplate x:Key="ActionItemTemplate">
      <Border x:Name="ActionBorder" Padding="10" Margin="0,6,0,6" CornerRadius="6">
        <Grid>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto"/>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
          </Grid.ColumnDefinitions>

          <!-- иконка-место -->
          <Border Width="40" Height="40" Background="#1E1E1E" CornerRadius="6" Margin="0,0,12,0" />

          <StackPanel Grid.Column="1" VerticalAlignment="Center">
            <TextBlock Text="{Binding Title}" FontSize="18" Foreground="#FFFFFF"/>
            <TextBlock Text="{Binding Description}" FontSize="13" Foreground="#BFBFBF"
                       TextTrimming="CharacterEllipsis" MaxWidth="380"/>
          </StackPanel>

          <!-- стоимость -->
          <TextBlock Grid.Column="2" Text="{Binding Cost}" VerticalAlignment="Center" FontSize="16" Foreground="#D8D8D8" />

          <!-- ToolTip: подробности -->
          <Border.ToolTip>
            <StackPanel Margin="8">
              <TextBlock Text="{Binding Title}" FontWeight="Bold"/>
              <TextBlock Text="{Binding Description}" TextWrapping="Wrap" Margin="0,6,0,0"/>
              <TextBlock Text="{Binding Duration, StringFormat=Длительность: {0:mm\\:ss}}" Margin="0,6,0,0"/>
              <TextBlock Text="{Binding Cost, StringFormat=Стоимость: {0}}" Margin="0,4,0,0"/>
            </StackPanel>
          </Border.ToolTip>

        </Grid>
      </Border>

      <!-- triggers: выделять если это текущее действие -->
    </DataTemplate>

    <!-- DataTemplate для элементов инвентаря -->
    <DataTemplate x:Key="InventoryItemTemplate">
      <Border Padding="8" CornerRadius="6" Background="#232428" Margin="0,6,0,6">
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
          <Rectangle Width="36" Height="36" Fill="#2B2B2B" RadiusX="6" RadiusY="6" />
          <StackPanel Margin="10,0,0,0">
            <TextBlock Text="{Binding Name}" Foreground="#FFF" FontSize="16"/>
            <TextBlock Text="{Binding Description}" Foreground="#BEBEBE" FontSize="12"/>
          </StackPanel>
        </StackPanel>
      </Border>
    </DataTemplate>

    <!-- DataTemplate для лог-записи -->
    <DataTemplate x:Key="LogEntryTemplate">
      <TextBlock Text="{Binding Message}" TextWrapping="Wrap" Foreground="#EDEDED" Margin="0,4,0,4"/>
    </DataTemplate>

  </UserControl.Resources>

  <!-- Основная вёрстка (портрет) -->
  <Grid Margin="20">
    <Grid.RowDefinitions>
      <RowDefinition Height="Auto"/>
      <RowDefinition Height="*"/>
      <RowDefinition Height="300"/>
    </Grid.RowDefinitions>

    <!-- === Шкалы (верх) === -->
    <local:ResourcesPanel Grid.Row="0" Margin="0,0,0,12"/>

    <!-- === Тело: действия и инвентарь === -->
    <Grid Grid.Row="1">
      <Grid.ColumnDefinitions>
        <ColumnDefinition Width="*"/>
        <ColumnDefinition Width="300"/>
      </Grid.ColumnDefinitions>

      <!-- Actions panel -->
      <local:ActionsPanel Grid.Column="0"/>

      <!-- Inventory panel -->
      <local:InventoryPanel Grid.Column="1"/>
    </Grid>

    <!-- === Лог снизу === -->
    <local:LogPanel Grid.Row="2"/>
  </Grid>
</UserControl>
